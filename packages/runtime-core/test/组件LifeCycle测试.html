<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>


</body>
</html>

<script type="module">

  // 官方的===========================
  // import {
  //   h,
  //   render,
  //   Fragment,
  //   ref,
  //   provide,
  //   inject,
  //   onBeforeMount,
  //   onBeforeUnmount,
  //   onBeforeUpdate,
  //   onMounted,
  //   onUnmounted,
  //   onUpdated,
  //   getCurrentInstance
  // } from '../node_modules/vue/dist/vue.esm-browser.js'

  import {
    h,
    render,
    Fragment,
    ref,
    provide,
    inject,
    onBeforeMount,
    onBeforeUnmount,
    onBeforeUpdate,
    onMounted,
    onUnmounted,
    onUpdated,
    getCurrentInstance
  } from '../../runtime-dom/dist/runtime-dom.js'

  // 用官方的和自己的进行对比测试

  const P1 = {
    setup ( props ) {
      const name = inject('name', '我是p1默认值')
      return () => {
        return h('h3', [ '我是孙子组件', h('div', name.value) ])
      }
    }
  }

  const P2 = {
    setup ( props ) {

      onBeforeMount(() => {
        console.log('子组件,挂载前')
        console.log('子组件,get实例', getCurrentInstance())
      })
      onMounted(() => {
        console.log('子组件, 挂载完成')
      })
      onBeforeUpdate(() => {
        console.log('子组件, 更新前')
      })
      onUpdated(() => {
        console.log('子组件更新完成')
      })
      onBeforeUnmount(() => {
        console.log('子组件, 卸载前')
      })
      onUnmounted(() => {
        console.log('子组件,卸载完成')
      })

      const age = inject('age', '我是p2默认值')
      return () => {
        // debugger
        return h('h2', [ '我是子组件', h('div', age.value), h(P1) ])
      }
    }
  }

  const P3 = {
    setup ( props ) {
      const name = ref('yyr')
      const age = ref(18)

      provide('name', name)
      provide('age', age)

      setTimeout(() => {
        // name.value += age.value
        age.value++
      }, 1000)

      onBeforeMount(() => {
        console.log('父组件,挂载前')
        console.log('父组件,get实例', getCurrentInstance())
      })

      onMounted(() => {
        console.log('父组件, 挂载完成')
      })

      onBeforeUpdate(() => {
        console.log('父组件, 更新前')
      })

      onUpdated(() => {
        console.log('父组件更新完成')
      })

      onBeforeUnmount(() => {
        console.log('父组件, 卸载前')
      })

      onUnmounted(() => {
        console.log('父组件,卸载完成')
      })

      return () => {
        return h('h1', [ '我是父组件age:' + age.value, h(P2, { key: age.value }) ])
      }
    }
  }

  // render(h(P3), document.body)
  // setTimeout(() => {
  //   render(null, document.body)
  // }, 2000)

  render.render(h(P3), document.body)
  setTimeout(() => {
    // debugger
    render.render(null, document.body)
  }, 2000)


</script>